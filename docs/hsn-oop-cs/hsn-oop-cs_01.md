# 第一章：C#作为一种语言的概述

随着现代编程实践的引入，显然开发人员正在寻找更先进的构造，以帮助他们以最有效的方式交付最佳软件。建立在框架之上的语言旨在增强开发人员的能力，使他们能够快速构建具有较少复杂性的代码，以便代码可维护且可读。

市场上有许多高级面向对象的编程语言，但其中我认为最有前途的是 C#。C#语言在编程世界中并不新，已经存在了十多年，但随着语言本身的动态进展创造了许多新的构造，它已经超越了一些最广泛接受的语言竞争。C#是一种面向对象的、类型安全的、通用的语言，它是建立在由微软开发并由**欧洲计算机制造商协会**（**ECMA**）和**国际标准化组织**（**ISO**）批准的.NET 框架之上的。它是建立在公共语言基础设施上的，并且可以与基于相同架构构建的任何其他语言进行交互。受 C++的启发，该语言在不处理过多代码复杂性的情况下提供了最优质的应用程序。

在本章中，我们将涵盖以下主题：

+   C#的演变

+   C#的架构

+   C#语言的基础和语法

+   Visual Studio 作为编辑器

+   在 Visual Studio 中编写你的第一个程序

# C#的演变

C#是近年来最具活力的语言之一。这门语言是开源的，主要由一群软件工程师推动，他们最近提出了许多重大变化，以增强语言并提供处理现有语言复杂性的功能。为该语言提出的一些主要增强功能包括泛型、LINQ、动态和异步/等待模式：

![](img/73797b91-d957-41f7-bd59-0b55cbde8a73.png)

在上图中，我们可以看到这门语言是如何从 C# 1.0 的托管代码开始演变的，到 C# 5.0 引入的异步编程构造，再到现代的 C# 8。在继续之前，让我们看一下 C#在不同演变阶段的一些亮点。

# 托管代码

托管代码这个词是在微软宣布.NET 框架之后出现的。在托管环境中运行的任何代码都由**公共语言运行时**（**CLR**）处理，它保持

# 泛型

泛型是在 C# 2.0 中引入的概念，允许模板类型定义和类型参数。泛型允许程序员定义具有开放类型参数的类型，这从根本上改变了程序员编写代码的方式。动态类型的泛型模板提高了可读性、可重用性和代码性能。

# LINQ

C#语言的第三个版本引入了**语言集成查询（LINQ）**，这是一种可以在对象结构上运行的新查询构造。LINQ 在编程世界中非常新颖，让我们一窥面向对象通用编程结构之上的函数式编程。LINQ 还引入了一堆新的接口，以`IQueryable`接口的形式，引入了许多可以使用 LINQ 与外部世界交互的库。Lambda 表达式和表达式树的引入提升了 LINQ 的性能。

# 动态

第四版还提供了一个全新的构造。它引入了动态语言结构。动态编程能力帮助开发人员将编程调用推迟到运行时。语言中引入了特定的语法糖，它在同一运行时编译动态代码。该版本还提出了许多增强其语言能力的新接口和类。

# 异步/等待

使用任何语言，线程或异步编程都是一种痛苦。在处理异步时，程序员必须面对许多复杂性，这些复杂性降低了代码的可读性和可维护性。有了 C#语言中的 async/await 功能，以异步方式编程就像同步编程一样简单。编程已经简化，所有复杂性都由编译器和框架在内部处理。

# 编译器作为服务

微软一直在研究如何向世界开放编译器源代码的某些部分。因此，作为程序员，您可以查询编译器的一些内部工作原理。C# 6.0 引入了许多库，使开发人员能够深入了解编译器、绑定器、程序的语法树等。尽管这些功能作为 Roslyn 项目开发了很长时间，但微软最终将其发布给外部世界。

# 异常过滤器

C# 6.0 装饰有许多较小的功能。其中一些功能为开发人员提供了实现简单代码的复杂逻辑的机会，而另一些则增强了语言的整体能力。异常过滤器是这个版本的新功能，它使程序能够过滤出特定的异常类型。异常过滤器作为 CLR 构造一直隐藏在语言中，但最终在 C# 6.0 中引入。

# C# 8 及更高版本

随着 C#成为市场上最具动态性的语言，它不断改进。通过新功能，如可空引用类型、异步流、范围和索引、接口成员等，以及最新版本的 C#带来的许多其他功能，它增强了基本功能，并帮助程序员利用这些新构造，从而使他们的生活更轻松。

请注意，在语言的演变过程中，.NET 框架也已开源。您可以在以下链接找到.NET 框架的源代码：[`referencesource.microsoft.com/`](https://referencesource.microsoft.com/)。

# .NET 架构

尽管它已有十年历史，但.NET 框架仍然构建良好，并确保将其分层、模块化和分级。每个层提供特定的功能给用户，有些是安全性方面的，有些是语言能力方面的。这些层为最终用户提供了一层抽象，并尽可能隐藏本机操作系统的大部分复杂性。.NET 框架被分成模块，每个模块都有自己独特的责任。较高层从较低层请求特定功能，因此它是分级的。

让我们来看一下.NET 架构的图表：

![](img/015b47d1-2a67-40d8-8ef0-348aee4382c1.png)

上图描述了.NET 框架架构的布局。在最低级别上，它是与操作系统交互的操作系统，该操作系统中存在与操作系统中的内核 API 交互的操作系统。公共语言基础设施与 CLR 连接，提供监视每个代码执行和管理内存、处理异常以及确保应用程序行为符合预期的服务。基础设施的另一个重要目标是语言互操作性。公共语言运行时再次通过.NET 类库进行抽象。该层保存了语言构建的二进制文件，所有构建在库之上的编译器提供相同的编译代码，以便 CLR 可以理解代码并轻松相互交互。

在继续之前，让我们快速看一下构建在.NET 框架上的语言的一些关键方面。

# 公共语言运行时

CLR 提供了底层未管理基础设施与托管环境之间的接口。这以垃圾回收、安全性和互操作性的形式提供了托管环境的所有基本功能。CLR 由即时编译器组成，该编译器将使用特定编译器生成的程序集代码编译为本机调用。CLR 是.NET 架构中最重要的部分。

# 公共类型系统

由于语言和框架之间存在一层抽象，因此很明显，每种语言文字都映射到特定的 CLR 类型。例如，VB.NET 的整数与 C#的整数相同，因为它们都指向相同的类型 System.Int32。始终建议使用语言类型，因为编译器会处理类型的映射。CTS 系统构建为`System.Object`位于其顶点的类型层次结构。**公共类型系统**（**CTS**）分为两种类型，一种是值类型，它们是从`System.ValueTypes`派生的原始类型，而其他任何类型都是引用类型。值类型与引用类型的处理方式不同。这是因为在分配内存时，值类型在执行期间在线程堆栈上创建，而引用类型始终在堆上创建。

# .NET 框架类库

框架类库位于语言和 CLR 之间，因此框架中存在的任何类型都暴露给您编写的语言。.NET 框架由大量类和结构组成，提供无穷尽的功能，您作为程序员可以从中受益。类库以可以直接从程序代码中引用的二进制形式存储。

# 即时编译器

.NET 语言被编译两次。在第一种编译形式中，高级语言被转换为**Microsoft 中间语言**（**MSIL**），CLR 可以理解，而在程序执行时，MSIL 再次被编译。JIT 在程序运行时内部工作，并定期编译预计在执行期间需要的代码。

# C#语言的基本原理和语法

作为一种高级语言，C#装饰有许多更新和更新的语法，这有助于程序员高效地编写代码。正如我们之前提到的，语言支持的类型系统分为两种类型：

+   值类型

+   引用类型

值类型通常是存储在堆栈中的原始类型，用于本地执行，以便更快地分配和释放内存。值类型在代码开发过程中大多被使用，因此构成了整个代码的主要范围。

# 数据类型

C#的基本数据类型分为以下几类：

+   布尔类型：`bool`

+   字符类型：`char`

+   整数类型：`sbyte`、`byte`、`short`、`ushort`、`int`、`uint`、`long`和`ulong`

+   浮点类型：`float`和`double`

+   小数精度：`decimal`

+   字符串：`string`

+   对象类型：`object`

这些是原始数据类型。这些数据类型嵌入在 C#编程语言中。

# 可空类型

在 C#中，原始类型或值类型是不可空的。因此，开发人员总是需要将类型设置为可空，因为开发人员可能需要确定值是否是显式提供的。最新版本的.NET 提供了可空类型：

```cs
Nullable<int> a = null;
int? b = a; //same as above
```

在前面的示例中，两行都定义了可空变量，而第二行只是第一次声明的快捷方式。当值为 null 时，`HasValue`属性将返回`false`。这将确保您可以检测变量是否显式指定为值。

# 文字

文字也是任何程序的重要部分。C#语言为开发人员提供了不同种类的选项，允许程序员在代码中指定文字。让我们看看支持的不同类型的文字。

# 布尔

布尔文字以`true`或`false`的形式定义。除了`true`和`false`之外，布尔类型不能分配其他值：

```cs
bool result = true;
```

布尔类型的默认值是`false`。

# 整数

整数是一个可以有加号(+)或减号(-)作为前缀的数字，但这是可选的。如果没有给出符号，则被视为正数。您可以以 int、long 或十六进制形式定义数字文字：

```cs
int numberInDec = -16;
int numberInHex = -0x10;
long numberinLong = 200L;
```

您可以看到，第一个文字`-16`是指定为整数变量的文字，而相同的值是使用十六进制文字分配给整数的。长变量被分配了一个带有`L`后缀的值。

# 真实

实数是带有正负号的数字序列，如整数。这也使得可以指定分数值：

```cs
float realNumber = 12.5f;
realNumber = 1.25e+1f;
double realdNumber = 12.5;
```

正如您所看到的，最后一行中的文字`12.5`默认为`double`，因此需要分配给 double 变量，而前两行指定了浮点类型中的文字。您还可以指定`d`或`D`作为后缀来定义`double`，例如`f`或`F`用于`float`和`m`用于 decimal。

# 字符

字符文字需要保留在单引号内。文字的值可以如下：

+   一个字符，例如，`c`

+   字符代码，例如，`\u0063`

+   转义字符，例如，`\\`（反斜杠是一个转义字符）

# 字符串

字符串是一系列字符。在 C#中，字符串由双引号表示。在 C#中有不同的创建字符串的方式。让我们看看在 C#中创建字符串的不同方式：

```cs
string s = "hello world";
string s1 = "hello \n\r world"; //prints the string with escape sequence
string s2 = @"hello \n\r world"; //prints the string without escape sequence
string s3 = $"S1 : {s1}, S2: {s2}"; // Replaces the {s1} and {s2} with values
```

`@`字符可以放在字符串前面作为前缀，以便将字符串作为原样处理，而不必担心任何转义字符。它被称为原始字符串。`$`字符用作字符串插值的前缀。如果您的字符串文字以`$`符号开头，则如果它们放在`{ }`括号内，变量将自动替换为值。

# 编程语法-条件

条件是任何程序的最常见构建块之一。程序不能只有单个维度；比较、跳转和中断是 C#中最常见的练习形式。有三种类型的条件可用：

+   `if...else`

+   `switch-case`

+   `goto`（无条件 lumps）

# If-else 结构

最常用的条件语句是 if-else 结构。if-else 结构的基本组成部分包含一个`if`关键字，后面跟着一个布尔表达式和一组花括号来指定要执行的步骤。可选地，可能会有一个`else`关键字，后面跟着花括号，用于在`if`块为`false`时执行的代码：

```cs
int a = 5;
if (a == 5)
{
   // As a is 5, do something
}
else
{
  // As a is not 5, do something
}
```

if-else 结构也可以有一个 else-if 语句来指定多个执行条件。

# Switch-case 结构

另一方面，switch-case 几乎与`if`语句类似；在这个语句中，case 将确定执行步骤。在`switch`的情况下，这总是落在一组离散的值中，因此，这些值可以被设置：

```cs
int a = 5;
switch (a)
{
  case 4:
     // Do something; 
     break;
  case 5:
     // Do something;
     break;
 default:
     // Do something;
     break;
}
```

switch case 会自动选择正确的 case 语句，取决于值，并执行块内定义的步骤。case 需要以 break 语句结束。

# goto 语句

尽管它们不太受欢迎，也不建议使用，`goto`语句用于语言中的无条件跳转，并且被语言本身广泛使用。作为开发人员，你可以使用`goto`语句跳转到程序中的任何位置：

```cs
... code block
goto lbl1;
...
...
lbl1: expression body
```

`goto`语句直接跳转到指定的位置，没有任何条件或标准。

# 编程语法 - 循环

对于执行过程中的重复任务，循环发挥着至关重要的作用。循环允许程序员定义循环将在何时结束，或者循环应该执行到何时的条件，具体取决于循环的类型。有四种类型的循环：

+   当

+   do-while

+   对于

+   Foreach

# while 结构

在编程世界中，循环用于使一系列执行步骤重复，直到满足条件。`while`循环是 C#编程架构的基本组成部分之一，用于循环执行大括号中提到的循环体，直到`while`条件中提到的条件为`true`：

```cs
while (condition)
{
  loop body;
}
```

循环中提到的条件应该评估为`true`，以执行下一次迭代的循环。

# do-while 结构

`do...while`结构在执行一次步骤后检查条件。尽管`do...while`循环类似于`while`循环，但`do...while`循环和`while`循环之间唯一的区别是，`do...while`循环将至少执行一次循环体，即使条件为`false`：

```cs
do
{
  loop body;
}
while (condition);
```

# for 结构

语言中最流行的循环是`for`循环，它通过在块内部高效地维护循环的执行次数来处理复杂性：

```cs
for (initialization; condition; update)
{
  /* loop body */
}
```

`for`循环在条件中有几个部分。每个部分都用分号(`;`)分隔。第一部分定义了索引变量，在执行循环之前执行一次。第二部分是在每次`for`循环迭代时执行的条件。如果条件变为`false`，`for`循环将停止执行。第三部分也在每次执行循环体后执行，并且操作了在`for`循环初始化和条件中使用的变量。

# foreach 结构

`foreach`循环是语言中的新功能，用于迭代对象序列。尽管这在语言中纯粹是语法糖，但在处理集合时，`foreach`循环被广泛使用。`foreach`循环内部使用`IEnumerable<object>`接口，并且应该只用于实现了该接口的对象：

```cs
foreach (type variable in collection)
{
    //statements;
}
```

# 上下文 - break 和 continue 语句

如果你在使用循环，理解另外两个上下文关键字是非常重要的，它们使得与循环进行交互成为可能。

# Break

这允许开发人员在条件仍然有效的情况下中断循环并将上下文带出循环。编程上下文关键字`break`用作绕过正在执行的循环的循环。`break`语句在循环和 switch 语句中有效。

# Continue

这用于调用下一次迭代。上下文关键字允许开发人员继续到下一步，而不执行块中的任何其他代码。

现在，让我们看看如何在我们的程序中使用这两个上下文语句：

```cs
var x = 0;
while(x<=10)
{
   x++;
   if(x == 2)continue;
   Console.WriteLine(x);
   if(x == 5) break;
   Console.WriteLine("End of loop body");
}
Console.WriteLine($"End of loop, X : {x}");
```

前面的代码将跳过迭代值为`2`的循环体的执行，因为有`continue`语句。循环将一直执行直到`x`的值为`5`，因为有`break`语句。

# 在控制台应用程序中编写您的第一个 C#程序

现在您已经了解了 C#语言的基本知识和基础知识，文字，循环，条件等，我认为是时候看一个 C#代码示例了。所以，让我们通过编写一个简单的控制台应用程序，编译它，并使用 C#编译器运行它来开始本节。

打开您计算机上的任何记事本应用程序，并输入以下代码：

```cs
using System;

public  Program
{
      static void Main(string[] args)
      {
          int num, sum = 0, r;
          Console.WriteLine("Enter a Number : ");
          num = int.Parse(Console.ReadLine());
          while (num != 0)
          {
              r = num % 10;
              num = num / 10;
              sum = sum + r;
          }
          Console.WriteLine("Sum of Digits of the Number : " + sum);
          Console.ReadLine();
      }
}
```

上述代码是计算数字所有数字之和的经典示例。它使用`Console.ReadLine()`函数作为输入，解析并将其存储到变量`num`中，循环遍历直到数字为`0`，并取模`10`以获得除法的余数，然后将其相加以产生结果。

您可以看到代码块顶部有一个`using`语句，它确保可以调用`Console.ReadLine()`和`Console.WriteLine()`。`System`是代码中的一个命名空间，它使程序能够调用其中定义的类，而无需指定类的完整命名空间路径。

让我们将类保存为`program.cs`。现在，打开控制台并将其移动到您保存代码的位置。

要编译代码，我们可以使用以下命令：

```cs
csc Program.cs
```

编译将产生类似于这样的东西：

![](img/2f54ec56-f834-44ce-85f9-aaeb2570861c.png)

编译将产生`program.exe`。如果您运行此程序，它将接受数字作为输入并产生结果：

![](img/19038024-805d-4d63-bfab-9ebfef4760a2.png)

您可以看到代码正在控制台窗口中执行。

如果我们进一步分析代码的执行方式，我们可以看到.NET 框架提供了`csc`编译器，这是一个能够将我的 C#代码编译成托管可执行文件的可执行文件。编译器生成一个包含 MSIL 的可执行文件，然后在执行可执行文件时，.NET 框架调用一个可执行文件，并使用 JIT 进一步编译它，以便与输入/输出设备进行交互。

`csc`编译器提供了各种命令行钩子，可以进一步用于向程序添加**动态链接库**（**dll**）引用，将输出目标设置为 dll 等。您可以在以下链接找到完整的功能文档：[`docs.microsoft.com/en-us/dotnet/csharp/language-reference/compiler-options/listed-alphabetically`](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/compiler-options/listed-alphabetically)。

# Visual Studio 作为编辑器

微软创建了许多改进工具集，帮助创建，调试和运行程序。其中一个工具就是**Visual Studio**（**VS**）。微软 VS 是一个与微软语言一起工作的开发环境。这是开发人员可以依赖的工具，以便他们可以轻松地使用微软技术。VS 已经存在了相当长的时间，但新的 VS 已经完全重新设计，并作为 VS 2019 发布，以支持.NET 语言。

# Visual Studio 的演变

随着时间的推移，微软发布了更多优势和增强功能的新版本 VS。作为托管许多服务作为插件的插件主机，VS 已经发展出许多工具和扩展。它一直是每个开发人员活动的核心部分。VS 已被许多不属于开发人员社区的人使用，因为他们发现这个 IDE 对编辑和管理文档很有益。

# Visual Studio 的类型

微软推出了不同类型或版本的 VS。这些版本之间的区别在于功能和定价。其中一个版本是免费的，而其他版本需要购买。因此，了解哪个版本提供了哪些功能，哪个版本更适合哪种类型的工作，将使开发人员更容易选择合适的版本。

让我们来比较一下所有版本的 VS。

# Visual Studio Community

VS 社区版是免费版。这个版本没有一些其他版本中可用的高级功能，但这个社区版完全适用于构建小型/中型项目。这对于想要探索 C#编程语言的人特别有用，因为他们可以免费下载这个版本并开始构建应用程序。

# Visual Studio Professional

这个版本的 VS 是为您自己的开发而设计的，具有重要的调试工具和所有常用的开发人员工具。因此，您可以将 IDE 用作您的主要方向，然后可以继续！

# Visual Studio Enterprise

VS 企业版是为需要商业级 IDE 使用的企业而设计的。它支持用于测试、调试等的特殊工具。它还可以发现常见的编码错误，生成测试数据等等。

# Visual Studio Code

VS Code 是一个小型的开源工具，不是完整的 IDE，而是由微软开发的简单代码编辑器。这个编辑器非常轻量级且与平台无关。VS Code 没有大多数 VS IDE 具有的功能，但具有足够的功能来开发和调试应用程序。

对于本书，我们将在大多数情况下使用 VS 社区版，但您可以安装任何您希望的版本。您可以免费下载社区版，网址如下：[`www.visualstudio.com/downloads/`](https://www.visualstudio.com/downloads/)。

# Visual Studio IDE 简介

安装 VS 后，VS 安装程序将为您提供关于工作负载的几个选项，这意味着您将使用此 IDE 开发的应用程序类型。对于本书，我们只会创建 C#控制台应用程序，因此您可以选择该选项。现在，让我们开始 VS IDE。加载 IDE 后，它将显示一个带有多个选项的起始页面。选择创建新项目的选项。

# 新项目

选择新项目后，将出现新项目对话框。在此对话框中，将基于当前与 IDE 一起安装的软件包提供一些选项，如下图所示：

![](img/5e1316ae-e768-453e-b989-0eadeab4ed8d.png)

在上图中，左侧的分组是您可以选择的模板类型。在这里，我选择了 Windows 桌面，并从中间窗口中选择了控制台应用程序(.NET 框架)来创建我的应用程序。屏幕底部允许您命名项目并选择存储项目文件的位置。有两个复选框可用，其中一个说“选择时创建解决方案目录”（默认情况下，此复选框保持选中状态）。这将在所选路径下创建一个目录并将文件放入其中，否则它将在文件夹内部创建文件。

使用“搜索已安装的模板”在对话框的右上角按名称搜索任何模板，如果找不到您的模板。由于一台 PC 上可以存在多个框架，新项目对话框将允许您选择一个框架；在部署应用程序时需要使用它。默认情况下，它显示.NET 框架 4.6.1 作为项目的框架，但您可以通过从下拉菜单中选择一个来更改为任何框架。

最后，单击“确定”以使用默认文件创建项目：

![](img/354b45b5-260c-4e91-ae13-360897be8c3c.png)

前面的屏幕截图显示了项目创建后基本 IDE 的外观。我们还可以看到 IDE 的每个部分。主要 IDE 由许多工具窗口组成。您可以在屏幕的各个部分看到一些工具窗口。任务列表窗口位于屏幕底部。主要 IDE 工作区位于中间，形成了 IDE 的工作区域。可以使用屏幕角落的缩放控件放大工作区。屏幕顶部的 IDE 搜索框可以帮助您更优雅、更轻松地找到 IDE 内部的选项。现在我们将整个 IDE 分成这些部分，并探索 IDE。

# 解决方案资源管理器

文件夹和文件在解决方案资源管理器中按层次结构显示。解决方案资源管理器是主窗口，列出了加载到 IDE 中的整个解决方案。这使您可以以树的形式轻松导航查看具有解决方案的项目和文件。解决方案资源管理器的外部节点本身就是一个解决方案，然后是项目，然后是文件和文件夹。解决方案资源管理器支持加载解决方案中的文件夹，并在第一级存储文档。设置为启动的项目以粗体标记。

解决方案资源管理器顶部有许多称为工具栏按钮的按钮。根据树中所选文件，工具栏按钮将启用或禁用。让我们逐个查看它们：

+   折叠所有按钮：此按钮允许您折叠当前选定节点下方的所有节点。在处理大型解决方案时，通常需要完全折叠部分树。您可以使用此功能而无需手动折叠每个节点。

+   属性：作为打开属性窗口的快捷方式，您可以选择此按钮以打开属性窗口并加载与当前选择节点相关联的元数据。

+   显示所有文件：解决方案通常映射到文件系统中目录的文件夹结构。解决方案中包含的文件仅显示在解决方案树上。显示所有文件允许您在查看目录中的所有文件和仅添加到解决方案中的文件之间切换。

+   刷新：刷新当前解决方案中文件的状态。刷新按钮还会检查文件系统中的每个文件，并根据需要显示其状态。

+   查看类图：类图是命名空间和类的逻辑树，而不是文件系统中的文件。选择此选项时，VS 会启动具有其属性、方法等所有详细信息的类图。类图对于单独查看所有类及其关联非常有用。

+   查看代码：当选择代码文件时，将出现查看代码按钮，它会加载与当前选择相关联的代码文件。例如，当选择 Windows 窗体时，它将显示其代码后端，代码需要在其中编写。

+   查看设计器：有时，根据树中所选的文件类型，会出现查看设计器按钮。此按钮会启动与当前选择的文件类型相关联的设计器。

+   添加新文件夹：如我已经提到的，解决方案也可以包含文件夹。您可以使用添加新文件夹按钮直接向解决方案中添加文件夹。

+   创建新解决方案：有时，在处理大型项目时，您可能需要创建整个解决方案的子集，并仅列出您当前正在处理的项目。此按钮将创建一个与原始解决方案同步的单独的解决方案资源管理器，但会显示解决方案树的特定部分。

在 VS 中的解决方案树也以文件系统中的组织方式加载项目的类结构。如果你看到一个折叠的文件夹，你可以展开它来看看里面有什么。如果你展开一个`.cs`文件，那么该类的所有成员都会被列出来。如果你只想看看类是如何组织的，你可以使用类视图窗口，但是通过使用解决方案资源管理器，你可以看到类，以及其自己层次结构内的其他元素。你可以通过选择视图|类视图或按*Ctrl + W 和 C*来打开类视图，这样你就可以只查看类的一部分和其成员：

![](img/1b806af1-3d32-49bd-9325-46daf202e4f1.png)

在解决方案中有一些文件显示为空文件（在我们的情况下，像`bin`和`obj`这样的文件夹）。这意味着这些文件存在于文件系统中，但没有包含在解决方案文件中。

每个文件在解决方案中的树节点右侧都显示了额外的信息。这个按钮提供了与文件相关的额外信息。例如，如果你点击与`.cs`文件对应的按钮，它将打开一个带有`Contains`的菜单。这将在解决方案中为该特定文件获取关联的类视图。菜单可能会很长，取决于不能在通用工具栏按钮中显示的项目。当解决方案加载额外信息时，会有前进和后退按钮，可以用来在解决方案的视图之间导航。

# 主工作区域

主工作区域是你实际编写代码或对应用程序应用不同设置的地方。这个部分将打开你项目中的不同类型的文件。作为开发人员，你会在这个区域花费大部分时间编码。你可以在这个窗口中打开多个文件。不同的文件将显示在不同的标签中，你可以通过点击标签来在不同的标签之间切换。如果需要的话，你也可以固定标签。如果你认为需要这样，你可以让标签浮动，或者也可以使其全屏大小，这样你就可以专注于你正在工作的代码。

因此，当你在解决方案资源管理器中双击文件或从文件的上下文菜单中选择打开时，该文件将在主编辑区域的标签页中打开。这样，你可以在编辑器窗口中打开多个文件，并在需要时在不同的标签之间切换。每个标签标题都包含一些固定的项目集：

![](img/6267cd7c-b4ce-4bc1-b4ee-244ed3935694.png)

在上面的截图中，你可以看到标签标题包含文件的名称（`Program.cs`），它显示`*`当项目需要保存时，并且有一个切换固定按钮（就像所有其他 IDE 工具窗口一样），它可以使标签固定在左侧，并且有一个关闭按钮。标题部分有时也会指示一些额外的状态，例如，当文件被锁定时，它会显示一个锁图标，当对象从元数据中加载时，它会在方括号中显示，就像上面的截图中一样。在这个部分，当我们不断打开文件时，它会形成一个标签页的堆栈，一直到最后。当整个区域被占满时，它最终会在工作区标题的右上角创建一个菜单，用来保存所有不能在屏幕上显示的文件列表。从这个菜单中，你可以选择需要打开的文件。*Ctrl + Tab*也可以用来在工作区中已加载的标签之间切换。

在选项卡标题下方和主工作区域之前有两个下拉菜单。一个加载了在 IDE 中打开的类，右边的一个加载了文件中创建的所有成员。这些下拉菜单有助于更轻松地在文件中导航，左边列出了当前文件中加载的所有类，而右边则列出了上下文中存在的所有成员。这两个下拉菜单足够智能，可以在编辑器中添加新代码时自动更新下拉值。

主工作区域由两个滚动条限定，用于处理文档的溢出。然而，在垂直滚动条之后，有一个特殊的按钮可以分割窗口，如下面的屏幕截图所示：

![](img/ef0a01a8-f0c9-4939-84ad-21aad17d40b8.png)

另一方面，水平滚动条上有另一个下拉菜单，显示编辑器的当前缩放百分比。VS 现在允许您将编辑器缩放到您喜欢的缩放级别。缩放功能的快捷键是*Ctrl* +滚动鼠标滚轮。

# 输出窗口

输出窗口通常位于 IDE 底部，并在编译、连接到各种服务、开始调试或需要 IDE 显示一些代码时打开。输出窗口用于显示日志和跟踪消息：

![](img/e8288f79-7448-400a-97b0-939e02b33dd4.png)

输出窗口停靠在页面底部，列出各种类型的输出。从顶部的下拉菜单中，您可以选择要在输出窗口中看到的输出。您还可以选择清除日志，如果您只想显示更新的日志。

# 命令和即时窗口

命令窗口与 Windows 操作系统的命令提示符非常相似。您可以使用此工具执行命令。在 VS 命令行中，您可以在正在处理的项目上执行命令。命令非常方便，可以提高您的生产率，因为您不必四处拖动鼠标来执行某些操作。您可以运行命令轻松实现这一点。

要在 VS 中打开命令窗口，可以单击“查看”菜单，然后选择“窗口”。然后，选择“命令窗口”。或者，您可以使用键盘快捷键*Ctrl + Alt + A*来打开它。当您在命令窗口中时，您会看到每个输入前面都有一个`>`。这称为提示符。在提示符中，当您开始输入时，它将为您显示智能感知菜单。开始输入`Build.Compile`，项目将为您编译。您还可以使用`Debug.Start`来开始调试应用程序。您可以使用命令轻松调试应用程序。我将列出一些在使用命令窗口调试时经常使用的重要命令：

+   `?`: 告诉您变量的值（也可以使用`Debug.Print`执行相同操作）

+   `??`: 将变量发送到监视窗口

+   `locals`: 显示本地窗口

+   `autos`: 显示自动窗口

+   `GotoLn`: 将光标设置到特定行

+   `Bp`: 在当前行设置断点

与命令窗口类似，中间窗口允许您测试代码而无需运行它。中间窗口用于评估、执行语句，甚至打印变量值。要打开即时窗口，请转到“调试|窗口”并选择“即时”。

# IDE 中的搜索选项

在屏幕的右上角，您会找到一个新的搜索框。这称为 IDE 搜索框。VS IDE 非常庞大。其中有成千上万的选项可供配置。有时，很难找到您想要的特定选项。IDE 搜索功能可以帮助您更轻松地找到此选项：

![](img/4f733c3a-cef0-46ce-a811-8f23b5a91f6a.png)

搜索选项将列出与 VS IDE 选项相关的所有条目，您可以轻松找到您要查找的任何功能。

# 在 Visual Studio 中编写您的第一个程序

VS 是开发人员在使用 C#语言时主要编码的 IDE。由于您已经对 VS 的工作原理有了基本的了解，让我们在 VS 中编写我们的第一个程序。让我们创建一个控制台应用程序，将解决方案命名为`MyFirstApp`，然后按下 OK。默认的解决方案模板将自动添加，其中包括一个带有`Main`程序的`Program.cs`，以及其他一些文件。

让我们构建一个生成 ATM 机的程序。菜单中有三个选项：

+   提款

+   存款

+   余额检查

提款将在余额（最初为$1,000）上执行，存款将向当前余额添加金额。现在，让我们看看程序的样子：

```cs
class Program
{
  static void Main(string[] args)
  {
      int balance, depositAmt, withdrawAmt;
      int choice = 0, pin = 0;
      Console.WriteLine("Enter your ledger balance");
      balance = int.Parse(Console.ReadLine());
      Console.WriteLine("Enter Your Pin Number ");
      pin = int.Parse(Console.ReadLine());

      if(pin != 1234)
      {
          Console.WriteLine("Invalid PIN");
          Console.ReadKey(false);
          return;
      }

      while (choice != 4)
      {
          Console.WriteLine("********Welcome to PACKT Payment Bank**************\n");
          Console.WriteLine("1\. Check Balance\n");
          Console.WriteLine("2\. Withdraw Cash\n");
          Console.WriteLine("3\. Deposit Cash\n");
          Console.WriteLine("4\. Quit\n");
          Console.WriteLine("*********************************************\n\n");
          Console.WriteLine("Enter your choice: ");
          choice = int.Parse(Console.ReadLine());

          switch (choice)
          {
              case 1:
                  Console.WriteLine("\n Your balance $ : {0} ", balance);
                  break;
              case 2:
                  Console.WriteLine("\n Enter the amount you want to withdraw : ");
                  withdrawAmt = int.Parse(Console.ReadLine());
                  if (withdrawAmt % 100 != 0)
                  {
                      Console.WriteLine("\n Denominations present are 100, 500 and 2000\. Your amount cannot be processed");
                  }
                  else if (withdrawAmt > balance)
                  {
                      Console.WriteLine("\n Sorry, insufficient balance.");
                  }
                  else
                  {
                      balance = balance - withdrawAmt;
                      Console.WriteLine("\n\n Your transaction is processed.");
                      Console.WriteLine("\n Current Balance is {0}", balance);
                  }
                  break;
              case 3:
                  Console.WriteLine("\n Enter amount you want to deposit");
                  depositAmt = int.Parse(Console.ReadLine());
                  balance = balance + depositAmt;
                  Console.WriteLine("Your ledger balance is {0}", balance);
                  break;
              case 4:
                  Console.WriteLine("\n Thank you for using the PACKT ATM.");
                  break;
          }
      }
      Console.ReadLine();
  }
}
```

现在，让我们说明一下程序。程序在打开 ATM 机之前会要求输入 PIN 码。PIN 码不会被检查，可以是任何数字。一旦程序启动，它会在控制台的前面创建一个菜单，其中包含所有所需的选项。

您可以看到整个代码都写在一个`while`循环中，因为它确保程序保持活动状态以进行多次执行。在执行期间，您可以选择任何可用的选项并执行与之相关的操作。

要执行程序，只需单击 IDE 工具栏上的运行按钮：

![](img/0c757c06-5b31-4177-a91b-98fab60b2e87.png)

如果程序没有自动运行，您可以查看错误列表窗口以找出实际问题。如果代码中有错误，VS 将向您显示适当的错误消息，您可以双击它以导航到实际位置。

# 如何调试

如果您听说过 VS，您一定听说过 IDE 的调试功能。您可以按*F10*以调试模式启动程序。程序将以第一行的上下文启动调试模式。让我们执行几行。这将如下所示：

![](img/37fb2d11-7ce8-4f7b-b8e2-f21c4a3c4b12.png)

代码编辑器工作区中突出显示的行表示当前执行已停止的行。该行还在代码编辑器的最左边标有箭头。您可以继续按*F10*或*F11*（步入）按钮来执行这些行。您必须检查本地窗口，以了解在执行期间本地变量的所有值。

# 通过代码调试

对于真正高级的用户，.NET 类库开放了一些有趣的调试器 API，您可以从源代码中调用调试器手动调试。

从程序的一开始，有一个`DEBUG`预处理变量，它确定项目是否是以调试模式构建的。

您可以按以下方式编写代码：

```cs
#IF DEBUG
/// The code runs only in debug mode
#ENDIF
```

预处理指令实际上是在编译时评估的。这意味着`IF DEBUG`内部的代码只会在以调试模式构建项目时编译到程序集中。

还有其他选项，如`Debug.Assert`、`Debug.Fail`和`Debug.Print`。所有这些选项只在调试模式下工作。在发布模式下，这些 API 将不会被编译。

如果有任何可用的进程，您还可以调用附加到进程的调试器，使用`Debugger.Break()`方法，在当前行中断调试器。您可以检查调试器。`IsAttached`用于查找调试器是否附加到当前进程。

当您开始调试代码时，VS 会启动实际的进程以及一个带有`.vshost`文件名的进程。VS 通过启用部分信任的调试和使用`.vshost`文件来提高*F5*体验，增强了调试体验。这些文件在后台工作，将实际进程与预定义的应用程序域附加以进行调试，以实现无缝的调试体验。

`.vshost`文件仅由 IDE 使用，不应该在实际项目中进行部署。

VS 需要终端服务来运行这些调试器，因为它即使在同一台机器上也会与进程通信。它通过使用终端服务来保持对进程的正常和远程调试的无缝体验。

# 总结

在本章中，我们介绍了 C#语言的基础知识，并介绍了 VS 编辑器。我们还尝试使用命令行和 VS 编写了我们的第一个程序。

在下一章中，我们将继续讨论面向对象的概念和技术，这将使我们能够编写更多的类。
