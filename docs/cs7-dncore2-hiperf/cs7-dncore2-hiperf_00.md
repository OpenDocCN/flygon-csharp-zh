# 前言

本书首先介绍了 C# 7 和.NET Core 2.0 的新功能，以及它们如何帮助提高应用程序的性能。然后，本书将帮助您了解.NET Core 的核心内部，包括编译过程、垃圾回收、利用 CPU 的多个核心来开发高性能应用程序，以及使用强大的基准测试应用程序库 BenchmarkDotNet 来测量性能。我们将学习使用多线程和异步编程来开发应用程序和程序，以及如何利用这些概念构建高效的应用程序以实现更快的执行。接下来，您将了解数据结构优化的重要性以及如何有效地使用它。我们将继续讨论在.NET Core 中设计应用程序时使用的模式和最佳实践，以及如何有效地利用内存并避免内存泄漏。之后，我们将讨论在.NET Core 应用程序中实现安全性和弹性，并使用 Polly 框架来实现断路器、重试和回退模式，以及某些中间件来加固 HTTP 管道。我们还将使用 Identity 框架实现授权和身份验证等安全性。接下来，我们将学习微服务架构，以及如何使用它创建模块化、高度可扩展和独立部署的应用程序。最后，我们将学习如何使用 App Metrics 来监控应用程序的性能。

# 这本书适合谁

这本书适合.NET 开发人员，他们希望提高应用程序代码的速度，或者只是想将自己的技能提升到下一个水平，从而开发和生产不仅性能优越，而且符合行业最佳实践的高质量应用程序。假定具有基本的 C#知识。

# 本书涵盖的内容

第一章，*在.NET Core 2 和 C# 7 中的新功能*，讨论了.NET Core 框架，并涵盖了.NET Core 2.0 引入的一些改进。我们还将了解 C# 7 的新功能，以及如何编写更干净的代码和简化语法表达。最后，我们将涵盖编写高质量代码的主题。我们将看到如何利用 Visual Studio 2017 的代码分析功能向我们的项目添加分析器并改进代码质量。

第二章，*了解.NET Core 内部和测量性能*，讨论了.NET Core 的核心概念，包括编译过程、垃圾回收、利用 CPU 的多个核心来构建高性能的.NET Core 应用程序，以及使用发布版本构建发布应用程序。我们还将探讨用于代码优化的基准测试工具，并提供特定于内存对象的结果。

第三章，*在.NET Core 中进行多线程和异步编程*，探讨了多线程和异步编程的核心基础知识。本章从多线程和异步编程之间的基本区别开始，并引导您了解核心概念。它探讨了 API 以及在编写多线程应用程序时如何使用它们。我们将学习如何使用任务编程库来执行异步操作，以及如何实现任务异步模式。最后，我们将探讨并行编程技术以及一些最佳的设计模式。

第四章，“C#中的数据结构和编写优化代码”，概述了数据结构的核心概念、数据结构的类型以及它们的优缺点，然后介绍了每种数据结构适用的最佳场景。我们还将学习大 O 符号，这是编写代码时需要考虑的核心主题之一，有助于开发人员检查代码质量和性能。最后，我们将探讨一些最佳实践，并涵盖诸如装箱和拆箱、字符串连接、异常处理、`for`和`foreach`以及委托等主题。

第五章，“.NET Core 应用程序性能设计指南”，展示了一些使应用程序代码看起来整洁且易于理解的编码原则。如果代码整洁，它可以让其他开发人员完全理解，并在许多其他方面有所帮助。我们将学习一些基本的设计原则，这些原则被认为是设计应用程序时的核心原则的一部分。像 KISS、YAGNI、DRY、关注点分离和 SOLID 这样的原则在软件设计中非常重要，缓存和选择正确的数据结构对性能有重大影响，如果使用得当，可以提高性能。最后，我们将学习在处理通信、资源管理和并发时应考虑的一些最佳实践。

第六章，“.NET Core 中的内存管理技术”，概述了.NET 中内存管理的基本过程。我们将探索调试工具，开发人员可以使用它来调查堆上对象的内存分配。我们还将了解内存碎片化、终结器以及如何通过实现`IDisposable`接口来实现处理模式以清理资源。

第七章，“在.NET Core 应用程序中实现安全和弹性”，带您了解弹性，这是在.NET Core 中开发高性能应用程序时非常重要的因素。我们将学习不同的策略，并使用 Polly 框架在.NET Core 中使用这些策略。我们还将了解安全存储机制以及如何在开发环境中使用它们，以便将敏感信息与项目存储库分开。在本章末尾，我们将学习一些安全基础知识，包括 SSL、CSRF、CORS、安全标头和 ASP.NET Core 身份框架，以保护 ASP.NET Core 应用程序。

第八章，“微服务架构”，着眼于基于微服务的快速发展的软件架构，用于开发云端高性能和可扩展的应用程序。我们将学习微服务架构的一些核心基础知识、其优势以及在设计架构时使用的模式和实践。我们将讨论将企业应用程序分解为微服务架构风格时面临的挑战，并学习诸如 API 组合和 CQRS 之类的模式以解决这些挑战。在本章后期，我们将在.NET Core 中开发一个基本应用程序，并讨论解决方案的结构和微服务的组件。然后我们将开发身份和供应商服务。

第九章，*使用工具监视应用程序性能*，深入探讨了监视应用程序性能所必需的关键性能指标。我们将探索并设置 App Metrics，这是一个跨平台的免费工具，提供各种扩展，可用于实现广泛的报告。我们将逐步指南地介绍如何配置和设置 App Metrics 及相关组件，如 InfluxDb 和 Grafana，用于在 Grafana 基于 Web 的工具中存储和查看遥测，并将其与 ASP.NET Core 应用程序集成。

# 为了充分利用本书

读者应具备以下环境配置：

1.  **开发环境**：Visual Studio 2015/2017 社区版

1.  **执行环境**：.NET Core

1.  **操作系统环境**：Windows 或 Linux

# 下载示例代码文件

您可以从[www.packtpub.com](http://www.packtpub.com)的账户中下载本书的示例代码文件。如果您在其他地方购买了本书，可以访问[www.packtpub.com/support](http://www.packtpub.com/support)注册，直接将文件通过电子邮件发送给您。

您可以按照以下步骤下载代码文件：

1.  登录或注册[www.packtpub.com](http://www.packtpub.com/support)。

1.  选择“支持”选项卡。

1.  点击“代码下载和勘误”。

1.  在搜索框中输入书名，然后按照屏幕上的说明操作。

文件下载后，请确保使用最新版本的以下工具解压或提取文件夹：

+   Windows 上的 WinRAR/7-Zip

+   Mac 上的 Zipeg/iZip/UnRarX

+   Linux 上的 7-Zip/PeaZip

本书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/C-Sharp-7-and-NET-Core-2-High-Performance/`](https://github.com/PacktPublishing/C-Sharp-7-and-NET-Core-2-High-Performance/)。如果代码有更新，将在现有的 GitHub 存储库中进行更新。

我们还有其他代码包，来自我们丰富的图书和视频目录，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)上找到。快去看看吧！

# 下载彩色图片

我们还提供了一个 PDF 文件，其中包含本书中使用的屏幕截图/图表的彩色图片。您可以在此处下载：[`www.packtpub.com/sites/default/files/downloads/CSharp7andNETCore2HighPerformance_ColorImages.pdf`](https://www.packtpub.com/sites/default/files/downloads/CSharp7andNETCore2HighPerformance_ColorImages.pdf)。

# 使用的约定

本书中使用了许多文本约定。

`CodeInText`：表示文本中的代码词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名。例如：“将下载的`WebStorm-10*.dmg`磁盘映像文件挂载为系统上的另一个磁盘。”

代码块设置如下：

```cs
public static IWebHost BuildWebHost(string[] args) => 
  WebHost.CreateDefaultBuilder(args) 
    .UseMetrics() 
    .UseStartup<Startup>() 
    .Build(); 
```

任何命令行输入或输出都以以下形式书写：

```cs
Install-Package App.Metrics 
Install-Pacakge App.Metrics.AspnetCore.Mvc 
```

**粗体**：表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词会以这种形式出现在文本中。例如：“从管理面板中选择系统信息。”

警告或重要说明会以这种形式出现。

提示和技巧会以这种形式出现。

# 联系我们

我们非常欢迎读者的反馈。

**一般反馈**：发送电子邮件至`feedback@packtpub.com`，并在主题中提及书名。如果您对本书的任何方面有疑问，请发送电子邮件至`questions@packtpub.com`。

**勘误**：尽管我们已经尽最大努力确保内容的准确性，但错误是难免的。如果您在本书中发现错误，我们将不胜感激地请您向我们报告。请访问[www.packtpub.com/submit-errata](http://www.packtpub.com/submit-errata)，选择您的书，点击勘误提交表格链接，然后输入详细信息。

**盗版**：如果您在互联网上发现我们作品的任何形式的非法副本，我们将不胜感激，如果您能向我们提供位置地址或网站名称。请通过`copyright@packtpub.com`与我们联系，并附上材料链接。

**如果您有兴趣成为作者**：如果您在某个专业领域有专长，并且有兴趣撰写或为一本书做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com/)。

# 评论

请留下评论。一旦您阅读并使用了这本书，为什么不在您购买它的网站上留下评论呢？潜在的读者可以看到并使用您的公正意见来做出购买决定，我们在 Packt 可以了解您对我们产品的看法，我们的作者可以看到您对他们的书的反馈。谢谢！

有关 Packt 的更多信息，请访问[packtpub.com](https://www.packtpub.com/)。
