# 第二章：2

# 编程的构建模块

任何编程语言对于不熟悉的人来说都像古希腊语一样难以理解，C#也不例外。好消息是，在最初的神秘之下，所有编程语言都由相同的基本构建模块组成。变量、方法和类（或对象）构成了传统编程的 DNA；理解这些简单的概念将打开一个多样和复杂应用的全新世界。毕竟，地球上每个人的 DNA 中只有四种不同的核碱基；然而，我们每个人都是独特的生物。

如果你是编程新手，在本章中会有大量的信息涌向你，这可能标志着你写下的第一行代码。重点不是用事实和数字来过载你的大脑，而是通过日常生活中的例子给你一个编程构建模块的整体观。

本章主要讨论构成程序的各个部分的高层视图。在直接进入代码之前，了解事物如何运作不仅能帮助新手程序员找到自己的位置，还能通过易于记忆的参考加强对主题的理解。撇开闲话，本章将重点讨论以下主题：

+   定义变量

+   理解方法

+   引入类

+   使用注释

+   将构建模块组合在一起

# 定义变量

让我们从一个简单的问题开始：什么是变量？根据你的观点，有几种不同的回答方式：

+   **概念上**，变量是编程的最基本单元，就像原子是物理世界一样（除了弦理论）。一切都始于变量，没有它们程序就无法存在。

+   **技术上**，变量是计算机内存的一个小部分，它保存了一个分配的值。每个变量都会跟踪它的信息存储位置（这称为内存地址）、它的值和它的类型（比如数字、单词或列表）。

+   **实际上**，变量就是一个容器。你可以随意创建新的变量，填充它们，移动它们，改变它们的内容，并根据需要引用它们。它们甚至可以是空的，但仍然有用。

你可以在微软 C#文档中找到关于变量的深入解释[`docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/variables`](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/variables)。

变量的一个实际生活例子是邮箱——还记得吗？

![](img/B17573_02_01.png)

图 2.1：一排色彩斑斓的邮箱快照

它们可以装信件、账单、姨妈梅贝尔的照片——任何东西。重点是邮箱里的东西可能会有所不同：它们可以有名称，装信息（实体邮件），如果你有适当的安全许可，它们的内容甚至可以被更改。同样，变量可以容纳不同类型的信息。C#中的变量可以容纳字符串（文本）、整数（数字），甚至布尔值（代表真或假的二进制值）。

## 名称很重要

参考*图 2.1*，如果我让你过去打开邮箱，你可能会问的第一件事是：哪一个？如果我说史密斯家的邮箱，或者向日葵邮箱，甚至是最右边的垂头丧气的邮箱，那么你就有了打开我所指的邮箱所需的上下文。同样，当你创建变量时，你必须给它们一个你以后可以引用的唯一名称。我们将在*第三章*，*深入变量、类型和方法*中详细讨论适当的格式和描述性命名。

## 变量充当占位符

当你创建并命名一个变量时，你就创建了一个存储数值的占位符。让我们以以下简单的数学方程为例：

```cs
2 + 9 = 11 
```

好了，这里没有什么神秘的，但如果我们想让数字`9`成为它的变量呢？考虑以下代码块：

```cs
MyVariable = 9 
```

现在我们可以使用变量名`MyVariable`来替代我们需要的`9`：

```cs
2 + MyVariable = 11 
```

如果你想知道变量是否有其他规则或规定，答案是肯定的。我们将在下一章中介绍这些内容，所以请耐心等待。

尽管这个例子不是真正的 C#代码，但它说明了变量的威力以及它们作为占位符引用的用途。在下一节中，你将开始创建自己的变量，所以继续前进吧！

好了，理论够了，让我们在我们在*第一章*，*了解你的环境*中创建的`LearningCurve`脚本中创建一个真正的变量：

1.  从 Unity 项目窗口中双击`LearningCurve.cs`，在 Visual Studio 中打开它。

1.  在第 6 行和第 7 行之间添加一个空格，并添加以下代码行来声明一个新变量：

```cs
public int CurrentAge = 30; 
```

1.  在`Start`方法中，添加两个调试日志，打印出以下计算结果：

```cs
 Debug.Log(30 + 1);
    Debug.Log(CurrentAge + 1); 
```

让我们分解刚刚添加的代码。首先，我们创建了一个名为`CurrentAge`的新变量，并将其赋值为`30`。然后，我们添加了两个调试日志，打印出`30 + 1`和`CurrentAge + 1`的结果，以展示变量是值的存储器。它们可以与值本身完全相同地使用。

还要注意的是，`public`变量会出现在 Unity 检视面板中，而`private`变量不会。现在不用担心语法，只需确保你的脚本与下面截图中显示的脚本相同：

![](img/B17573_02_02.png)

图 2.2：在 Visual Studio 中打开的 LearningCurve 脚本

最后，使用**编辑器** | **文件** | **保存**保存文件。

要在 Unity 中运行脚本，它们必须附加到场景中的*游戏对象*上。*英雄诞生*中的示例场景默认包含摄像机和定向光，这为场景提供了照明，所以让我们将`LearningCurve`附加到摄像机上，以保持简单：

1.  将`LearningCurve.cs`拖放到**主摄像机**上。

1.  选择**主摄像机**，使其出现在**检视器**面板中，并验证`LearningCurve.cs`（脚本）组件是否正确附加。

1.  点击播放并观察**控制台**面板中的输出：![](img/B17573_02_03.png)

图 2.3：Unity 编辑器窗口，带有拖放脚本的标注

`Debug.Log()`语句打印出了我们放在括号中的简单数学方程的结果。正如你在下面的**控制台**截图中所看到的，使用我们的变量`CurrentAge`的方程的工作方式与它是一个实际数字一样：

![](img/B17573_02_04.png)

图 2.4：Unity 控制台显示了附加脚本的调试输出

我们将在本章末讨论 Unity 如何将 C#脚本转换为组件，但首先让我们来改变其中一个变量的值。

由于`CurrentAge`在第 7 行被声明为一个变量，如*图 2.2*所示，它存储的值可以被改变。更新后的值将传递到代码中使用变量的任何地方；让我们看看这个过程：

1.  如果场景仍在运行，请点击**暂停**按钮停止游戏

1.  在**检视器**面板中将**Current Age**更改为`18`，然后再次播放场景，观察**控制台**面板中的新输出：![](img/B17573_02_05.png)

图 2.5：Unity 控制台显示了调试日志和附加到主摄像机的 LearningCurve 脚本

第一个输出仍然是`31`，因为我们在脚本中没有改变任何东西，但第二个输出现在是`19`，因为我们在检视面板中改变了`CurrentAge`的值。

这里的目标不是讨论变量语法，而是展示变量如何作为容器，可以创建一次并在其他地方引用。我们将在*第三章*，*深入变量、类型和方法*中详细讨论。

现在我们知道如何在 C#中创建变量并赋值，我们准备好深入下一个重要的编程构建块：方法！

# 理解方法

单独的变量不能做更多的事情，只能跟踪其分配的值。虽然这很重要，但它们单独来说在创建有意义的应用程序方面并不是非常有用。那么，我们如何创建动作并在代码中驱动行为呢？简短的答案是使用方法。

在我们讨论方法是什么以及如何使用它们之前，我们应该澄清一个术语的小细节。在编程世界中，你经常会看到术语*方法*和*函数*被交替使用，特别是在 Unity 方面。

由于 C#是一种面向对象的语言（这是我们将在*第五章* *使用类、结构和面向对象编程*中介绍的内容），我们将在本书的其余部分使用术语*方法*，以符合标准的 C#指南。

当你在脚本参考或其他文档中遇到函数这个词时，想到方法。

## 方法驱动行为

与变量类似，定义编程方法可能会非常冗长或非常简短；这里有另外一个三方面的方法来考虑：

+   **概念上**，方法是应用程序中完成工作的方式。

+   **技术上**，方法是一个包含可执行语句的代码块，当通过名称调用方法时运行。方法可以接受参数（也称为参数），这些参数可以在方法的范围内使用。

+   **实际上**，方法是一组指令的容器，每次执行时都会运行。这些容器还可以接受变量作为输入，这些变量只能在方法内部引用。

总的来说，方法是任何程序的骨架——它们连接一切，几乎所有的东西都是基于它们的结构构建的。

你可以在 Microsoft C#文档中找到有关方法的深入指南，网址为[`docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/methods`](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/methods)。

## 方法也是占位符

让我们以一个过于简化的例子来加深概念。在编写脚本时，你实际上是按顺序放置代码行，让计算机执行。第一次需要将两个数字相加时，你可以像下面的代码块中那样直接相加：

```cs
SomeNumber + AnotherNumber 
```

但是然后你得出结论，这些数字需要在其他地方相加。

与其复制和粘贴相同的代码行，导致杂乱或“意大利面”代码并且应该尽量避免，你可以创建一个命名的方法来处理这个动作：

```cs
AddNumbers() 
{
    SomeNumber + AnotherNumber
} 
```

现在`AddNumbers`就像一个变量一样占据着内存中的位置；但是，它不是一个值，而是一系列指令。在脚本中的任何地方使用方法的名称（或调用它）都可以让你立即使用存储的指令，而无需重复任何代码。

如果你发现自己一遍又一遍地写相同的代码行，你很可能错过了简化或将重复操作合并为常见方法的机会。

这会产生程序员开玩笑称之为意大利面代码的东西，因为它可能会变得混乱。你也会听到程序员提到一个叫做**不要重复自己**（**DRY**）原则的解决方案，这是一个你应该牢记的口头禅。

和以前一样，一旦我们在伪代码中看到了一个新概念，最好是自己实现一下，这就是我们将在下一节中做的事情。

让我们再次打开`LearningCurve`，看看 C#中的方法是如何工作的。就像变量示例一样，你会想要将代码粘贴到你的脚本中，就像下面的截图中显示的那样。我已经删除了以前的示例代码，以使事情更整洁，但你当然可以将其保留在脚本中以供参考：

1.  在 Visual Studio 中打开`LearningCurve`。

1.  在第 8 行添加一个新变量：

```cs
public int AddedAge = 1; 
```

1.  在第 16 行添加一个新的方法，将`CurrentAge`和`AddedAge`相加并打印出结果：

```cs
void ComputeAge() 
{
    Debug.Log(CurrentAge + AddedAge);
} 
```

1.  在`Start`中调用新方法，使用以下行：

```cs
 ComputeAge(); 
```

在 Unity 中运行脚本之前，请确保您的代码看起来像以下截图：

![](img/B17573_02_06.png)

图 2.6：具有新的 ComputeAge 方法的 LearningCurve

1.  保存文件，然后返回 Unity 并点击播放，看看新的**控制台**输出。

您在第 16 到 19 行定义了您的第一个方法，并在第 13 行调用了它。现在，无论何时调用`ComputeAge()`，这两个变量都将被相加并打印到控制台上，即使它们的值发生变化。请记住，您在 Unity 检视器中将`CurrentAge`设置为`18`，检视器的值将始终覆盖 C#脚本中的值：

![](img/B17573_02_07.png)

图 2.7：更改检视器中变量值的控制台输出

继续尝试在**检视器**面板中尝试不同的变量值，看看它是如何运作的！关于您刚刚编写的实际代码语法的更多细节将在下一章中介绍。

在我们掌握了方法的整体概念之后，我们准备好着手处理编程领域中最大的主题——类！

# 介绍类

我们已经看到变量存储信息，方法执行操作，但是我们的编程工具包仍然有些有限。我们需要一种创建一种超级容器的方法，其中包含可以从容器内部引用的变量和方法。输入类：

+   **概念上**，类在单个容器内保存相关信息、操作和行为。它们甚至可以相互通信。

+   **技术上**，类是数据结构。它们可以包含变量、方法和其他编程信息，当类的对象被创建时，所有这些信息都可以被引用。

+   **实际上**，类是一个蓝图。它为使用类蓝图创建的任何对象（称为实例）制定了规则和法规。

您可能已经意识到类不仅在 Unity 中存在，而且在现实世界中也存在。接下来，我们将看一下最常见的 Unity 类以及类在实际中的功能。

您可以在 Microsoft C#文档中找到有关类的深入指南[`docs.microsoft.com/en-us/dotnet/csharp/fundamentals/types/classes`](https://docs.microsoft.com/en-us/dotnet/csharp/fundamentals/types/classes)。

## 一个常见的 Unity 类

在您想知道 C#中的类是什么样子之前，您应该知道您在整个本章中一直在使用一个类。默认情况下，Unity 中创建的每个脚本都是一个类，您可以从第 5 行的`class`关键字中看到：

```cs
public class LearningCurve: MonoBehaviour 
```

`MonoBehaviour`只是意味着这个类可以附加到 Unity 场景中的 GameObject 上。

类可以独立存在，当我们在*第五章*中创建独立类时，我们将看到这一点。

有时在 Unity 资源中，脚本和类这两个术语是可以互换使用的。为了保持一致，我将在脚本附加到 GameObject 时将 C#文件称为脚本，并在它们是独立的类时称为类。

## 类是蓝图

对于我们的最后一个例子，让我们想想一个当地的邮局。它是一个独立的、自包含的环境，具有属性，比如物理地址（一个变量），以及执行动作的能力，比如寄出您的邮件（方法）。

这使得邮局成为一个潜在类的绝佳例子，我们可以在以下伪代码块中概述：

```cs
public class PostOffice
{
    // Variables
    public string address = "1234 Letter Opener Dr."
    // Methods
    DeliverMail() {}
    SendMail() {}
} 
```

这里的主要要点是，当信息和行为遵循预定义的蓝图时，复杂的操作和类间通信变得可能。例如，如果我们有另一个类想要通过我们的`PostOffice`类发送一封信，它不必想知道去哪里执行此操作。它可以简单地从`PostOffice`类中调用`SendMail`函数，如下所示：

```cs
PostOffice().SendMail() 
```

或者，您可以使用它查找邮局的地址，这样您就知道在哪里寄信：

```cs
PostOffice().address 
```

如果你对单词之间使用句点（称为点表示法）有疑问，我们将在下一节中详细介绍。

## 类之间的通信

到目前为止，我们已经将类和 Unity 组件描述为独立的实体；实际上，它们是紧密相连的。要创建任何有意义的软件应用程序，都需要在类之间进行某种形式的交互或通信。

如果你还记得之前的邮局例子，示例代码使用句点（或点）来引用类、变量和方法。如果你把类想象成信息目录，那么点表示法就是索引工具：

```cs
PostOffice().Address 
```

类中的任何变量、方法或其他数据类型都可以用点表示法访问。这也适用于嵌套或子类信息，但我们将在*第五章*“使用类、结构和面向对象编程”中讨论所有这些主题。

点表示法也是驱动类之间通信的工具。每当一个类需要另一个类的信息或想要执行它的方法时，都会使用点表示法：

```cs
PostOffice().DeliverMail() 
```

点表示法有时被称为`.`运算符，所以如果在文档中看到这种提法，不要感到困惑。

如果点表示法还没有完全理解，不要担心，它会的。它是整个编程体系的血脉，将信息和上下文传递到需要的地方。

现在你对类有了更多了解，让我们谈谈你在编程生涯中最常用的工具——注释！

# 处理注释

你可能已经注意到`LearningCurve`有一行奇怪的文本（*图 2.6*中的**10**），以两个斜杠开头，这是脚本默认创建的。

这些是代码注释！在 C#中，有几种方法可以用来创建注释，而 Visual Studio（和其他代码编辑应用程序）通常会通过内置快捷方式使其更加容易。

一些专业人士可能不认为注释是编程的基本构建块，但我不得不尊重地不同意。正确地用有意义的信息注释你的代码是新程序员可以养成的最基本的习惯之一。

## 单行注释

以下单行注释与我们在`LearningCurve`中包含的注释类似：

```cs
// This is a single-line comment 
```

Visual Studio 不会将以两个斜杠开头（没有空格）的行编译为代码，因此你可以根据需要使用它们来向他人或未来的自己解释你的代码。

## 多行注释

由于名称中有，你可以合理地假设单行注释只适用于一行代码。如果你想要多行注释，你需要在注释文本周围使用斜杠和星号（分别作为开头和结尾字符）：`/*`和`*/`。

```cs
/* this is a 
      multi-line comment */ 
```

你也可以通过在 macOS 上使用`Cmd` + `/`快捷键和在 Windows 上使用`Ctrl` + `K` + `C`来对代码块进行注释和取消注释。

Visual Studio 还提供了一个方便的自动生成注释功能；在任何代码行（变量、方法、类等）的前一行输入三个斜杠，将出现一个摘要注释块。

看到示例注释是好的，但在你的代码中加入它们总是更好的。现在开始注释永远不会太早！

## 添加注释

打开`LearningCurve`，在`ComputeAge()`方法上方添加三个反斜杠：

![](img/B17573_02_08.png)

图 2.8：为方法自动生成的三行注释

你应该看到一个三行注释，其中包含由 Visual Studio 从方法名称生成的方法描述，夹在两个`<summary>`标签之间。当然，你可以通过按`Enter`键添加新行来更改文本，但一定不要触碰`<summary>`标签，否则 Visual Studio 将无法正确识别注释。

这些详细注释的有用之处在于，当您想了解自己编写的方法时，它就会变得清晰。如果您使用了三个斜杠的注释，只需将鼠标悬停在类或脚本中调用方法的任何位置，Visual Studio 就会弹出您的摘要：

![](img/B17573_02_09.png)

图 2.9：带有注释摘要的 Visual Studio 弹出信息框

您的基本编程工具包现在已经完成（至少是理论抽屉）。然而，我们仍然需要了解本章中所学内容在 Unity 游戏引擎中的应用，这将是我们下一节的重点！

# 组合基本组件

在处理完基本组件之后，现在是时候在结束本章之前进行一些 Unity 特定的整理工作了。具体来说，我们需要更多地了解 Unity 如何处理附加到游戏对象的 C#脚本。

在这个例子中，我们将继续使用我们的`LearningCurve`脚本和 Main Camera 游戏对象。

## 脚本变成组件

所有的游戏对象组件都是脚本，无论是你自己编写的还是 Unity 团队编写的。唯一的区别是 Unity 特定的组件，比如`Transform`，以及它们各自的脚本，不应该被用户编辑。

一旦您创建的脚本被放置到游戏对象上，它就会成为该对象的另一个组件，这就是为什么它会出现在**检视面板**中。对于 Unity 来说，它像任何其他组件一样行走、交谈和行动，包括组件下面的公共变量，可以随时更改。尽管我们不应该编辑 Unity 提供的组件，但我们仍然可以访问它们的属性和方法，使它们成为强大的开发工具。

当脚本成为组件时，Unity 还会进行一些自动的可读性调整。您可能已经注意到在*图 2.3*和*2.5*中，当我们将`LearningCurve`添加到 Main Camera 时，Unity 将其显示为`Learning Curve`，`CurrentAge`变为`Current Age`。

在*变量作为占位符*部分，我们看了如何在**检视面板**中更新变量，但重点是要了解这是如何工作的。有三种情况可以修改属性值：

+   在 Unity 编辑器窗口中的**播放模式**

+   在 Unity 编辑器窗口中的**开发模式**

+   在 Visual Studio 代码编辑器中

在播放模式下进行的更改会实时生效，这对于测试和微调游戏性非常有用。然而，需要注意的是，在播放模式下进行的任何更改在停止游戏并返回开发模式时都将丢失。

当您处于开发模式时，您对变量所做的任何更改都将被 Unity 保存。这意味着，如果您退出 Unity 然后重新启动它，更改将被保留。

在播放模式下，您在**检视面板**中对值所做的更改不会修改您的脚本，但它们会覆盖您在开发模式下分配的任何值。

在播放模式下进行的任何更改都会在停止播放模式时自动重置。如果您需要撤消在**检视面板**中所做的任何更改，可以将脚本重置为其默认（有时称为初始）值。单击任何组件右侧的三个垂直点图标，然后选择**重置**，如下面的屏幕截图所示：

![](img/B17573_02_10.png)

图 2.10：检视面板中的脚本重置选项

这应该让您放心——如果您的变量失控，总是可以进行硬重置。

## MonoBehaviour 的帮助

由于 C#脚本是类，Unity 如何知道要将某些脚本转换为组件而不是其他脚本呢？简短的答案是`LearningCurve`（以及 Unity 创建的任何脚本）继承自`MonoBehaviour`（Unity 提供的默认类）。这告诉 Unity，这个 C#类可以被转换为组件。

类继承的主题对于您的编程之旅来说有点高级；把`MonoBehaviour`类想象成向`LearningCurve`借用一些变量和方法。*第五章*，*使用类、结构和面向对象编程*，将详细介绍类继承。

我们使用的`Start()`和`Update()`方法属于`MonoBehaviour`，Unity 会自动在附加到 GameObject 的任何脚本上运行它们。`Start()`方法在场景开始播放时运行一次，而`Update()`方法在每帧运行一次（取决于您的机器的帧率）。

现在您对 Unity 的文档熟悉度有了很大提升，我为您准备了一个简短的可选挑战！

### 英雄的试炼-脚本 API 中的 MonoBehaviour

现在是时候让您自己熟悉使用 Unity 文档了，还有什么比查找一些常见的`MonoBehaviour`方法更好的方法呢：

+   尝试在脚本 API 中搜索`Start()`和`Update()`方法，以更好地了解它们在 Unity 中的作用，以及何时

+   如果您感到勇敢，可以进一步查看手册中的`MonoBehaviour`类，以获得更详细的解释

# 总结

我们在短短的几页中走了很长的路，但是理解变量、方法和类等基本概念的总体理论将为您打下坚实的基础。请记住，这些构建块在现实世界中有非常真实的对应物。变量保存值，就像邮箱保存信件一样；方法存储指令，就像食谱一样，用于预定义的结果；类就像真实的蓝图一样。如果您希望房子能够屹立不倒，就不能没有经过深思熟虑的设计来遵循。

本书的其余部分将带您深入学习 C#语法，从头开始，从下一章开始更详细地介绍如何创建变量、管理值类型以及使用简单和复杂的方法。

# 小测验-C#构建块

1.  变量的主要目的是什么？

1.  方法在脚本中扮演什么角色？

1.  脚本如何成为组件？

1.  点符号的目的是什么？

# 加入我们的 Discord！

与其他用户、Unity/C#专家和 Harrison Ferrone 一起阅读本书。提出问题，为其他读者提供解决方案，通过*问我任何事*会话与作者交谈，以及更多。

立即加入！

[`packt.link/csharpunity2021`](https://packt.link/csharpunity2021)

![](img/QR_Code_9781801813945.png)
